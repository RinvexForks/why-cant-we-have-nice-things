machine:
  php:
    version: 7.0.4
  node:
    version: stable
  environment:
    APP_ENV: testing

dependencies:
  cache_directories:
    - vendor
  pre:
    - echo "memory_limit = 1024M" > ~/.phpenv/versions/$(phpenv global)/etc/conf.d/memory.ini
    - echo "always_populate_raw_post_data = -1" > ~/.phpenv/versions/$(phpenv global)/etc/conf.d/post.ini
  override:
    - npm install npm@3 -g
    - npm install
    - composer install --prefer-source --no-interaction

database:
  pre:
    - cp .env.testing .env
  override:
    - vendor/bin/phinx migrate

test:
  override:
    - npm run build
    - composer test
    - npm run lint
    - composer lint -- --dry-run
